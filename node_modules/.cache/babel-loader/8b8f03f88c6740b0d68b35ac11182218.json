{"ast":null,"code":"import _defineProperty from\"/Users/frankie/sparta/hanghae_react/magazine_test/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _objectSpread from\"/Users/frankie/sparta/hanghae_react/magazine_test/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";var _handleActions;import{createAction,handleActions}from\"redux-actions\";import{produce}from\"immer\";import{firestore}from\"../../shared/firebase\";import firebase from\"firebase/app\";import{actionCreators as postActions}from\"./post\";var SET_LIKE=\"SET_LIKE\";var ADD_LIKE=\"ADD_LIKE\";var LOADING=\"LOADING\";var UN_LIKE=\"UN_LIKE\";var setlike=createAction(SET_LIKE,function(post_id,user_list){return{post_id:post_id,user_list:user_list};});var addlike=createAction(ADD_LIKE,function(post_id,user_id){return{post_id:post_id,user_id:user_id};});var unlike=createAction(UN_LIKE,function(post_id,user_id){return{post_id:post_id,user_id:user_id};});var initialState={list:{}};var addLikeFB=function addLikeFB(post_id){return function(dispatch,getState,_ref){var history=_ref.history;var likeDB=firestore.collection(\"like\");var user_info=getState().user.user;var like={post_id:post_id,user_id:user_info.uid};likeDB.add(like).then(function(doc){var postDB=firestore.collection(\"post\");var post=getState().post.list.find(function(l){return l.id===post_id;});var increment=firebase.firestore.FieldValue.increment(1);like=_objectSpread(_objectSpread({},like),{},{id:doc.id});postDB.doc(post_id).update({like_cnt:increment}).then(function(_post){dispatch(addlike(post_id,user_info.uid));if(post){dispatch(postActions.editPost(post_id,{like_cnt:parseInt(post.like_cnt)+1}));}});});};};var getLikeFB=function getLikeFB(post_id){return function(dispatch,getState,_ref2){var history=_ref2.history;if(!post_id){return;}var likeDB=firestore.collection(\"like\");likeDB.where(\"post_id\",\"==\",post_id).get().then(function(docs){var list=[];docs.forEach(function(doc){list.push(doc.data().user_id);});dispatch(setlike(post_id,list));}).catch(function(error){console.log(\"좋아요 정보를 가져올 수가 없네요ㅜㅜ\",error);});};};var unLikeFB=function unLikeFB(post_id){return function(dispatch,getState,_ref3){var history=_ref3.history;var likeDB=firestore.collection(\"like\");var user_info=getState().user.user;likeDB.where(\"post_id\",\"==\",post_id).where(\"user_id\",\"==\",user_info.uid).get().then(function(docs){var id=\"\";docs.forEach(function(doc){return id=doc.id;});likeDB.doc(id).delete().then(function(){var postDB=firestore.collection(\"post\");var post=getState().post.list.find(function(l){return l.id===post_id;});var decrement=firebase.firestore.FieldValue.increment(-1);postDB.doc(post_id).update({like_cnt:decrement}).then(function(_post){dispatch(unlike(post_id,user_info.uid));if(post){if(parseInt(post.like_cnt)===0){return;}dispatch(postActions.editPost(post_id,{like_cnt:parseInt(post.like_cnt)-1}));}});});}).catch(function(error){console.log(\"좋아요를 취소할 포스트를 찾을수가 없어요ㅜㅜ\");});};};export default handleActions((_handleActions={},_defineProperty(_handleActions,SET_LIKE,function(state,action){return produce(state,function(draft){draft.list[action.payload.post_id]=action.payload.user_list;});}),_defineProperty(_handleActions,ADD_LIKE,function(state,action){return produce(state,function(draft){draft.list[action.payload.post_id].push(action.payload.user_id);});}),_defineProperty(_handleActions,UN_LIKE,function(state,action){return produce(state,function(draft){draft.list[action.payload.post_id]=draft.list[action.payload.post_id].filter(function(l){return l!==action.payload.user_id;});});}),_handleActions),initialState);var actionCreators={addLikeFB:addLikeFB,getLikeFB:getLikeFB,unLikeFB:unLikeFB};export{actionCreators};","map":{"version":3,"sources":["/Users/frankie/sparta/hanghae_react/magazine_test/src/redux/modules/like.js"],"names":["createAction","handleActions","produce","firestore","firebase","actionCreators","postActions","SET_LIKE","ADD_LIKE","LOADING","UN_LIKE","setlike","post_id","user_list","addlike","user_id","unlike","initialState","list","addLikeFB","dispatch","getState","history","likeDB","collection","user_info","user","like","uid","add","then","doc","postDB","post","find","l","id","increment","FieldValue","update","like_cnt","_post","editPost","parseInt","getLikeFB","where","get","docs","forEach","push","data","catch","error","console","log","unLikeFB","delete","decrement","state","action","draft","payload","filter"],"mappings":"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","sourcesContent":["import { createAction, handleActions } from \"redux-actions\";\nimport { produce } from \"immer\";\nimport { firestore } from \"../../shared/firebase\";\n\nimport firebase from \"firebase/app\";\nimport { actionCreators as postActions } from \"./post\";\n\nconst SET_LIKE = \"SET_LIKE\";\nconst ADD_LIKE = \"ADD_LIKE\";\nconst LOADING = \"LOADING\";\nconst UN_LIKE = \"UN_LIKE\";\n\nconst setlike = createAction(SET_LIKE, (post_id, user_list) => ({\n  post_id,\n  user_list,\n}));\nconst addlike = createAction(ADD_LIKE, (post_id, user_id) => ({\n  post_id,\n  user_id,\n}));\nconst unlike = createAction(UN_LIKE, (post_id, user_id) => ({\n  post_id,\n  user_id,\n}));\n\nconst initialState = {\n  list: {},\n};\n\nconst addLikeFB = (post_id) => {\n  return function (dispatch, getState, { history }) {\n    const likeDB = firestore.collection(\"like\");\n    const user_info = getState().user.user;\n\n    let like = {\n      post_id: post_id,\n      user_id: user_info.uid,\n    };\n\n    likeDB.add(like).then((doc) => {\n      const postDB = firestore.collection(\"post\");\n\n      const post = getState().post.list.find((l) => l.id === post_id);\n\n      const increment = firebase.firestore.FieldValue.increment(1);\n\n      like = { ...like, id: doc.id };\n\n      postDB\n        .doc(post_id)\n        .update({ like_cnt: increment })\n        .then((_post) => {\n          dispatch(addlike(post_id, user_info.uid));\n\n          if (post) {\n            dispatch(\n              postActions.editPost(post_id, {\n                like_cnt: parseInt(post.like_cnt) + 1,\n              })\n            );\n          }\n        });\n    });\n  };\n};\n\nconst getLikeFB = (post_id) => {\n  return function (dispatch, getState, { history }) {\n    if (!post_id) {\n      return;\n    }\n\n    const likeDB = firestore.collection(\"like\");\n\n    likeDB\n      .where(\"post_id\", \"==\", post_id)\n      .get()\n      .then((docs) => {\n        let list = [];\n        docs.forEach((doc) => {\n          list.push(doc.data().user_id);\n        });\n\n        dispatch(setlike(post_id, list));\n      })\n      .catch((error) => {\n        console.log(\"좋아요 정보를 가져올 수가 없네요ㅜㅜ\", error);\n      });\n  };\n};\n\nconst unLikeFB = (post_id) => {\n  return function (dispatch, getState, { history }) {\n    const likeDB = firestore.collection(\"like\");\n    const user_info = getState().user.user;\n\n    likeDB\n      .where(\"post_id\", \"==\", post_id)\n      .where(\"user_id\", \"==\", user_info.uid)\n      .get()\n      .then((docs) => {\n        let id = \"\";\n        docs.forEach((doc) => (id = doc.id));\n        likeDB\n          .doc(id)\n          .delete()\n          .then(() => {\n            const postDB = firestore.collection(\"post\");\n\n            const post = getState().post.list.find((l) => l.id === post_id);\n\n            const decrement = firebase.firestore.FieldValue.increment(-1);\n\n            postDB\n              .doc(post_id)\n              .update({ like_cnt: decrement })\n              .then((_post) => {\n                dispatch(unlike(post_id, user_info.uid));\n                if (post) {\n                  if (parseInt(post.like_cnt) === 0) {\n                    return;\n                  }\n                  dispatch(\n                    postActions.editPost(post_id, {\n                      like_cnt: parseInt(post.like_cnt) - 1,\n                    })\n                  );\n                }\n              });\n          });\n      })\n      .catch((error) => {\n        console.log(\"좋아요를 취소할 포스트를 찾을수가 없어요ㅜㅜ\");\n      });\n  };\n};\nexport default handleActions(\n  {\n    [SET_LIKE]: (state, action) =>\n      produce(state, (draft) => {\n        draft.list[action.payload.post_id] = action.payload.user_list;\n      }),\n    [ADD_LIKE]: (state, action) =>\n      produce(state, (draft) => {\n        draft.list[action.payload.post_id].push(action.payload.user_id);\n      }),\n    [UN_LIKE]: (state, action) =>\n      produce(state, (draft) => {\n        draft.list[action.payload.post_id] = draft.list[\n          action.payload.post_id\n        ].filter((l) => l !== action.payload.user_id);\n      }),\n  },\n  initialState\n);\n\nconst actionCreators = {\n  addLikeFB,\n  getLikeFB,\n  unLikeFB,\n};\n\nexport { actionCreators };\n"]},"metadata":{},"sourceType":"module"}