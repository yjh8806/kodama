{"ast":null,"code":"import { createAction, handleActions } from \"redux-actions\";\nimport { produce } from \"immer\";\nimport { firestore } from \"../../shared/firebase\";\nimport { actionCreators as postActions } from \"./post\";\nconst SET_LIKE = \"SET_LIKE\";\nconst ADD_LIKE = \"ADD_LIKE\";\nconst LOADING = \"LOADING\";\nconst UN_LIKE = \"UN_LIKE\";\nconst setlike = createAction(SET_LIKE, (post_id, user_list) => ({\n  post_id,\n  user_list\n}));\nconst addlike = createAction(ADD_LIKE, (post_id, user_id) => ({\n  post_id,\n  user_id\n}));\nconst unlike = createAction(UN_LIKE, (post_id, user_id) => ({\n  post_id,\n  user_id\n}));\nconst initialState = {\n  list: {}\n};\n\nconst addLikeFB = post_id => {\n  return function (dispatch, getState, {\n    history\n  }) {\n    const likeDB = firestore.collection(\"like\");\n    const user_info = getState().user.user;\n    let like = {\n      post_id: post_id,\n      user_id: user_info.uid\n    };\n    likeDB.add(like).then(doc => {\n      const postDB = firestore.collection(\"post\");\n      const post = getState().post.list.find(l => l.id === post_id);\n      const increment = firebase.firestore.FieldValue.increment(1);\n      like = { ...like,\n        id: doc.id\n      };\n      postDB.doc(post_id).update({\n        like_cnt: increment\n      }).then(_post => {\n        dispatch(addlike(post_id, user_info.uid));\n\n        if (post) {\n          dispatch(postActions.editPost(post_id, {\n            like_cnt: parseInt(post.like_cnt) + 1\n          }));\n        }\n      });\n    });\n  };\n};\n\nconst getLikeFB = post_id => {\n  return function (dispatch, getState, {\n    history\n  }) {\n    if (!post_id) {\n      return;\n    }\n\n    const likeDB = firestore.collection(\"like\");\n    likeDB.where(\"post_id\", \"==\", post_id).get().then(docs => {\n      let list = [];\n      docs.forEach(doc => {\n        list.push(doc.data().user_id);\n      });\n      console.log(list);\n      dispatch(setlike(post_id, list));\n    }).catch(error => {\n      console.log(\"좋아요 정보를 가져올 수가 없네요ㅜㅜ\", error);\n    });\n  };\n};\n\nconst unLikeFB = post_id => {\n  return function (dispatch, getState, {\n    history\n  }) {\n    const likeDB = firestore.collection(\"like\");\n    const user_info = getState().user.user;\n    likeDB.where(\"post_id\", \"==\", post_id).where(\"user_id\", \"==\", user_info.uid).get().then(docs => {\n      let id = \"\";\n      docs.forEach(doc => id = doc.id);\n      likeDB.doc(id).delete().then(() => {\n        const postDB = firestore.collection(\"post\");\n        const post = getState().post.list.find(l => l.id === post_id);\n        const decrement = firebase.firestore.FieldValue.increment(-1);\n        postDB.doc(post_id).update({\n          like_cnt: decrement\n        }).then(_post => {\n          dispatch(unlike(post_id, user_info.uid));\n\n          if (post) {\n            if (parseInt(post.like_cnt) === 0) {\n              return;\n            }\n\n            dispatch(postActions.editPost(post_id, {\n              like_cnt: parseInt(post.like_cnt) - 1\n            }));\n          }\n        });\n      });\n    }).catch(error => {\n      console.log(\"좋아요를 취소할 포스트를 찾을수가 없어요ㅜㅜ\");\n    });\n  };\n};\n\nexport default handleActions({\n  [SET_LIKE]: (state, action) => produce(state, draft => {\n    draft.list.is_liked = action.payload.is_liked;\n  }),\n  [ADD_LIKE]: (state, action) => produce(state, draft => {\n    draft.list[action.payload.post_id].push(action.payload.user_id);\n  }),\n  [LOADING]: (state, action) => produce(state, draft => {\n    draft.is_loading = action.payload.is_loading;\n  })\n}, initialState);\nconst actionCreators = {\n  addLikeFB,\n  getLikeFB,\n  unLikeFB\n};\nexport { actionCreators };","map":{"version":3,"sources":["/Users/frankie/sparta/hanghae_react/magazine_test/src/redux/modules/like.js"],"names":["createAction","handleActions","produce","firestore","actionCreators","postActions","SET_LIKE","ADD_LIKE","LOADING","UN_LIKE","setlike","post_id","user_list","addlike","user_id","unlike","initialState","list","addLikeFB","dispatch","getState","history","likeDB","collection","user_info","user","like","uid","add","then","doc","postDB","post","find","l","id","increment","firebase","FieldValue","update","like_cnt","_post","editPost","parseInt","getLikeFB","where","get","docs","forEach","push","data","console","log","catch","error","unLikeFB","delete","decrement","state","action","draft","is_liked","payload","is_loading"],"mappings":"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","sourcesContent":["import { createAction, handleActions } from \"redux-actions\";\nimport { produce } from \"immer\";\nimport { firestore } from \"../../shared/firebase\";\nimport { actionCreators as postActions } from \"./post\";\n\nconst SET_LIKE = \"SET_LIKE\";\nconst ADD_LIKE = \"ADD_LIKE\";\nconst LOADING = \"LOADING\";\nconst UN_LIKE = \"UN_LIKE\";\n\nconst setlike = createAction(SET_LIKE, (post_id, user_list) => ({\n  post_id,\n  user_list,\n}));\nconst addlike = createAction(ADD_LIKE, (post_id, user_id) => ({\n  post_id,\n  user_id,\n}));\nconst unlike = createAction(UN_LIKE, (post_id, user_id) => ({\n  post_id,\n  user_id,\n}));\n\nconst initialState = {\n  list: {},\n};\n\nconst addLikeFB = (post_id) => {\n  return function (dispatch, getState, { history }) {\n    const likeDB = firestore.collection(\"like\");\n    const user_info = getState().user.user;\n\n    let like = {\n      post_id: post_id,\n      user_id: user_info.uid,\n    };\n\n    likeDB.add(like).then((doc) => {\n      const postDB = firestore.collection(\"post\");\n\n      const post = getState().post.list.find((l) => l.id === post_id);\n\n      const increment = firebase.firestore.FieldValue.increment(1);\n\n      like = { ...like, id: doc.id };\n\n      postDB\n        .doc(post_id)\n        .update({ like_cnt: increment })\n        .then((_post) => {\n          dispatch(addlike(post_id, user_info.uid));\n\n          if (post) {\n            dispatch(\n              postActions.editPost(post_id, {\n                like_cnt: parseInt(post.like_cnt) + 1,\n              })\n            );\n          }\n        });\n    });\n  };\n};\n\nconst getLikeFB = (post_id) => {\n  return function (dispatch, getState, { history }) {\n    if (!post_id) {\n      return;\n    }\n\n    const likeDB = firestore.collection(\"like\");\n\n    likeDB\n      .where(\"post_id\", \"==\", post_id)\n      .get()\n      .then((docs) => {\n        let list = [];\n        docs.forEach((doc) => {\n          list.push(doc.data().user_id);\n        });\n        console.log(list);\n\n        dispatch(setlike(post_id, list));\n      })\n      .catch((error) => {\n        console.log(\"좋아요 정보를 가져올 수가 없네요ㅜㅜ\", error);\n      });\n  };\n};\n\nconst unLikeFB = (post_id) => {\n  return function (dispatch, getState, { history }) {\n    const likeDB = firestore.collection(\"like\");\n    const user_info = getState().user.user;\n\n    likeDB\n      .where(\"post_id\", \"==\", post_id)\n      .where(\"user_id\", \"==\", user_info.uid)\n      .get()\n      .then((docs) => {\n        let id = \"\";\n        docs.forEach((doc) => (id = doc.id));\n        likeDB\n          .doc(id)\n          .delete()\n          .then(() => {\n            const postDB = firestore.collection(\"post\");\n\n            const post = getState().post.list.find((l) => l.id === post_id);\n\n            const decrement = firebase.firestore.FieldValue.increment(-1);\n\n            postDB\n              .doc(post_id)\n              .update({ like_cnt: decrement })\n              .then((_post) => {\n                dispatch(unlike(post_id, user_info.uid));\n                if (post) {\n                  if (parseInt(post.like_cnt) === 0) {\n                    return;\n                  }\n                  dispatch(\n                    postActions.editPost(post_id, {\n                      like_cnt: parseInt(post.like_cnt) - 1,\n                    })\n                  );\n                }\n              });\n          });\n      })\n      .catch((error) => {\n        console.log(\"좋아요를 취소할 포스트를 찾을수가 없어요ㅜㅜ\");\n      });\n  };\n};\nexport default handleActions(\n  {\n    [SET_LIKE]: (state, action) =>\n      produce(state, (draft) => {\n        draft.list.is_liked = action.payload.is_liked;\n      }),\n    [ADD_LIKE]: (state, action) =>\n      produce(state, (draft) => {\n        draft.list[action.payload.post_id].push(action.payload.user_id);\n      }),\n    [LOADING]: (state, action) =>\n      produce(state, (draft) => {\n        draft.is_loading = action.payload.is_loading;\n      }),\n  },\n  initialState\n);\n\nconst actionCreators = {\n  addLikeFB,\n  getLikeFB,\n  unLikeFB,\n};\n\nexport { actionCreators };\n"]},"metadata":{},"sourceType":"module"}